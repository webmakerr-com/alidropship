jQuery((function(t){(function(){var e,a={countItemPage:20,countProductPage:10,tmpl:{list:"#coupons",more:"#ali-more-template",product:t("#tmpl-product").html(),apply:t("#tmpl-product-added").html(),applyEmpty:t("#tmpl-product-apply-empty").html()},target:{list:"#p-coupons",disResult:"#ads-search-results"},args:{},add:{selectApplyto:'[name="prod_type"]',btnProduct:".js-select-product",productBox:"#addProduct",selectCat:".js-select-cat",list:".list-applyto",delitem:".js-delete-product",product:".js-add-product",applyto:'[name="applyto"]',never_expires:'[name="never_expires"]',box_applyto:".list-applyto-box"},search:{disApply:"#ads-search-apply",disChose:"#chose",disResult:"#ads-search-results",categories:"#addProduct select#product_cat",disSearch:"#ads-search"}};function d(){var e=t(document).find(a.add.applyto).val();return e=""!=e?e.split(","):[]}function o(){var e=t(a.add.selectApplyto).val();if(t(a.add.btnProduct).hide(),t(a.add.selectCat).hide(),t(a.add.productBox).hide(),"product"!==e&&t(a.add.list).html(""),"product"==e)t(a.add.btnProduct).show(),c(1);else if("categories"==e){t(a.add.list).html("");var d=[];t("option:selected",a.add.selectCat).each((function(){d.push(t(this).val())})),t(a.add.applyto).val(d.join()),t(a.add.selectCat).show()}}function n(){var e=t("#tickbox").is(":checked");t('[name="tickbox_value"]').closest(".tickbox_value_box").toggle(e)}function i(){var e=t("#enabled_apply_email").is(":checked");t('[name="apply_to_email"]').closest(".apply_email_box").toggle(e)}function s(e){var d=t(document).find(a.add.applyto);t(a.add.list).find(".item-added-"+e).remove();var o=d.val();o=(o=""!=o?o.split(","):[]).filter((function(t,a,d){return t!=e})),d.val(o.join())}function c(e){var d=a.countProductPage;!function(e){var d=t(document).find(a.add.applyto).val(),o=(d=""!=d?d.split(","):[]).length;o>a.countProductPage?(t(a.add.box_applyto).find(".pagination-menu").show(),window.ADS.createJQPagination(a.add.box_applyto,o,e,a.countProductPage)):t(a.add.box_applyto).find(".pagination-menu").hide()}(e);var o=t(document).find(a.add.applyto),n=o.val(),i=(e-1)*d,s=(n=""!=n?n.split(","):[]).slice(i,i+d).length;t(a.add.list).html(window.ADS.objTotmpl(a.tmpl.applyEmpty,{count:s})),t.ajax({url:ajaxurl,dataType:"json",data:{action:"ads_discount",ads_actions:"ads_search_ids",post_ids:n.slice(i,i+d).join(),args:window.ADS.serialize(o.closest(".discount-edit"))},type:"POST",success:function(e){t(a.add.list).html(window.ADS.objTotmpl(a.tmpl.apply,{products:e})),t('[data-toggle="tooltip"]').tooltip()}})}return{init:function(){e||((e=this).render(),e.handler(),e.handlerSearch())},request:function(e,a,d){t.ajax({url:ajaxurl,data:{action:"ads_discount",ads_actions:e,args:a},type:"POST",dataType:"json",success:d})},render:function(){this.request("ads_get_discount","",e.listRender)},formatRender:function(t){var e=t.args,a=1;for(var d in e){var o=e[d];o.status=1==o.status,o.never_expires=1==o.never_expires,o.count=o.count?o.count:"0",o.count_max_view=o.count_max?o.count_max:"∞",o.date_active_view="2038/01/19 03:01:07"===o.date_active||o.never_expires?"∞":moment(o.date_active).format("MMM, D HH:mm"),o.date_view=moment(o.date).format("MMM, D HH:mm"),o.count_max=0!==o.count_max?o.count_max:"",o.tickbox_value_view=o.tickbox_value,o.tickbox_auto=1==o.tickbox_auto,o.num=a++,e[d]=o}return{items:e}},listRender:function(d){var o=t(a.tmpl.list).html(),n=t(a.target.list);d&&(d.hasOwnProperty("error")?window.ADS.notify(d.error,"danger"):(a.args=d.args,n.html(window.ADS.objTotmpl(o,e.formatRender(d))),setTimeout(window.ADS.switchery(n),300),d.open&&(e.editRender(d.open),window.ADS.scrollToNode('[data-id="'+d.open+'"]',50)),d.message&&window.ADS.notify(d.message,"success"))),window.ADS.btnUnLock(t(".js-delete")),window.ADS.btnUnLock(t(".js-save")),window.ADS.btnUnLock(t("#js-add-new-coupons"))},editRender:function(s){var l=a.args[s],r=t(a.tmpl.more).html(),p=t(".discount-edit-"+s),u=!p.html();if(t('[data-id="'+s+'"]').removeClass("edit"),t(".discount-edit").html(""),u){t('[data-id="'+s+'"]').addClass("edit"),p.html(window.ADS.objTotmpl(r,e.formatEdit(l))),t(a.add.btnProduct,"body").selectProductsAds((function(e){var d=e.join(",");t(document).find(a.add.applyto).val(d),c(1)}),{list:d}),e.daterangepicker(p),setTimeout(window.ADS.switchery(t(a.target.list)),300);var m=t(a.add.applyto).val();m=m?m.split(","):[],p.find('[multiple="multiple"]').multiselect("select",m),o(),n(),i(),c(1),t(a.search.categories).selectpicker(),t('[data-toggle="tooltip"]').tooltip({trigger:"hover"}),window.ADS.scrollToNode('[data-id="'+s+'"]',50,200)}},formatEdit:function(t){return t},daterangepicker:function(e){var a=e.find(".daterange-predefined"),d=e.find('[name="date"]'),o=e.find('[name="date_active"]'),n=t("#never_expires").is(":checked");a.daterangepicker("remove"),a.daterangepicker({locale:{format:"YYYY/MM/DD HH:mm"},autoApply:!1,autoUpdateInput:!0,singleDatePicker:n,startDate:d.val(),endDate:o.val(),timePicker:!0,timePicker24Hour:!0,opens:"right",applyClass:"btn-small bg-slate",cancelClass:"btn-small btn-default"},(function(e,i){var s=n?"":" &nbsp; - &nbsp; "+i.format("MMMM D, YYYY");a.find("span").html(e.format("MMMM D, YYYY")+s),t(a.data("ads_from")).val(e.format("YYYY/MM/DD HH:mm:ss")),t(a.data("ads_to")).val(i.format("YYYY/MM/DD HH:mm:ss")),d.val(e.format("YYYY/MM/DD HH:mm:ss")),o.val(i.format("YYYY/MM/DD HH:mm:ss"))}));var i=n?"":" &nbsp; - &nbsp; "+moment(o.val()).format("MMMM D, YYYY");a.find("span").html(moment(d.val()).format("MMMM D, YYYY")+i)},handler:function(){var e=this,d=t(document);d.on("click",".js-delete",(function(){var d=t(this).closest(".table-item").attr("data-id");window.ADS.btnLock(t(this)),e.request("ads_delete_discount",{code:a.args[d].code},e.listRender)})),d.on("click",".js-edit",(function(a){a.preventDefault();var d=t(this).closest(".table-item").attr("data-id");e.editRender(d)})),d.on("click","#js-add-new-coupons",(function(a){window.ADS.btnLock(t("#js-add-new-coupons")),e.request("ads_add_discount","",e.listRender)})),d.on("click",".js-cancel",(function(e){e.preventDefault();var a=t(this).closest(".discount-edit").attr("data-id");t(".discount-edit-"+a).html("")})),d.on("click",".js-save",(function(a){a.preventDefault();var d=t(this).closest(".discount-edit");window.ADS.btnLock(t(".js-save")),e.request("ads_edit_discount",window.ADS.serialize(d),e.listRender)})),t("body").on("change",'[name="prod_type"]',(function(){t(a.add.applyto).val(""),o()})),t("body").on("change",a.add.selectCat,(function(){o()})),t("body").on("click",a.add.product,(function(){var e=t(this).data("pid"),d=t(document).find(a.add.applyto),o=d.val();(o=""!=o?o.split(","):[]).push(e),o=o.filter((function(t,e,a){return e==a.indexOf(t)})),d.val(o.join()),function(e){t(".product-item-"+e).find(a.add.product).hide(),t(".product-item-"+e).find(".js-delete-product-add").show()}(e),c(1)})),t("body").on("click","#tickbox",(function(){n()})),t("body").on("click","#enabled_apply_email",(function(){i()})),t("body").on("change","#never_expires",(function(){var a=t(this).closest(".discount-edit");e.daterangepicker(a)}))},handlerSearch:function(){t("body").on("pagination:click",a.add.box_applyto,(function(t){c(t.page)})),t("body").on("click",a.add.delitem,(function(){s(t(this).data("pid")),o()})),t("body").on("click",".js-delete-product-add",(function(e){var d=t(this).data("pid");s(d),function(e){t(".product-item-"+e).find(a.add.product).show(),t(".product-item-"+e).find(".js-delete-product-add").hide()}(d)}))}}})().init()}));