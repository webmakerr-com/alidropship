jQuery((function(e){window.adsModal={init:function(){e("#ads-modal").length||e("body").append(e("#ads-tmpl-modal").html())},clear:function(){e("#ads-modal .modal-title").text(""),e("#ads-modal .modal-body").html(""),e("#ads-modal .modal-footer").html(""),e("#ads-modal .modal-dialog").removeClass("modal-md").removeClass("modal-lg")},hide:function(){window.adsModal.clear(),e("#ads-modal").modal("hide")},show:function(t,i,r,a){window.adsModal.clear(),t=t||"",i=i||"",r=r||"",a=a||"lg",e("#ads-modal .modal-title").text(t),e("#ads-modal .modal-body").html(i),e("#ads-modal .modal-footer").html(r),e("#ads-modal .modal-dialog").addClass("modal-"+a),e("#ads-modal").modal("show"),setTimeout(window.ADS.switchery(e("#ads-modal")),300)}},window.adsModal.init(),{isUrl:function(e){return/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},init:function(){var e=this;Handlebars.registerHelper("gravatar",(function(t,i){return t=Handlebars.escapeExpression(t),e.isUrl(t)?new Handlebars.SafeString('<img src="'+t+'" class="gravatar">'):new Handlebars.SafeString('<span class="gravatar text-uppercase '+i+'">'+t+"</span>")})),Handlebars.registerHelper("image",(function(e,t){return 1===t?e.replace("_640x640.jpg","_50x50.jpg"):e.replace("_640x640.jpg","")}))}}.init();var t={list:"#ali-list-template",orders:"#ali-orders-list",notfound:"#ali-list-notfound",more:"#ali-more-template"},i="#checkAll",r={page:"#ads_page"},a={details:"#order-details",shipping:"#order-shipping",billing:"#order-billing-details",action:"#order-action",items:"#order-items",tmpl_details:"#tmpl-details",tmpl_shipping:"#tmpl-shipping",tmpl_billing:"#tmpl-billing",tmpl_action:"#tmpl-action",tmpl_items:"#tmpl-list-items"};window.Orders={request:function(t,i,r){i=""!==i&&i instanceof jQuery?window.ADS.serialize(i):i,e.ajax({url:ajaxurl,data:{action:"ads_action_orders",ads_action:t,args:i},type:"POST",dataType:"json",success:r})},listOrders:function(){this.request("list_orders",e("#params"),this.listOrdersRender)},listOrdersRender:function(i){var r=e(t.list).html(),a=e(t.orders);i&&(i.hasOwnProperty("error")?window.ADS.notify(i.error,"danger"):(0===i.orders.length&&(r=e(t.notfound).html()),a.html(window.ADS.objTotmpl(r,i)),setTimeout(window.ADS.switchery(a),300),a.find(".pagination-menu").length&&window.ADS.createJQPagination("#"+a.attr("id"),i.total,i.ads_page)))},showMoreRender:function(i){var r=e(t.more).html();i&&(i.hasOwnProperty("error")?window.ADS.notify(i.error,"danger"):e(".order-more-"+i.id).html(window.ADS.objTotmpl(r,i)))},renderChangeStatus:function(t){if(t)if(t.hasOwnProperty("error"))window.ADS.notify(t.error,"danger");else{window.ADS.notify(t.message,"success");var i=e('[data-id="'+t.id+'"]');i.find(".gravatar").removeClass("blue green orange dark light-red").addClass(t.color),i.find(".fulfillment").removeClass("status- status-blue status-green status-orange status-dark status-light-red").addClass("status-"+t.color)}},changeFulfillment:function(e){this.request("change_fulfillment","fulfillment="+e.val()+"&id="+e.parents(".order-item").data("id"),this.renderChangeStatus)},checker:function(){e(document).on("change",i,(function(){e(t.orders).find('[name="order_id"]').prop("checked",e(this).is(":checked")),e.uniform.update()})),e(t.orders).on("click",'[name="order_id"]',(function(){var r=e(t.orders).find('[name="order_id"]:not(:checked)');r.length&&e(i).prop("checked")?e(i).prop("checked",!1):0!==r.length||e(i).prop("checked")||e(i).prop("checked",!0),e.uniform.update(i)}))},toTrashRender:function(e){e&&(e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):(window.ADS.notify(e.message,"success"),Orders.listOrders()))},toTrash:function(i){var a=i.closest(".order-item");e(t.orders).find('[name="id"]').length<=1&&e(r.page).val(1),this.request("to_trash_order",a,this.toTrashRender)},toTrashItems:function(t){var i=[];t.each((function(){i.push(e(this).data("id"))})),i.length&&e(r.page).val(1),this.request("to_trash_orders",{ids:i},this.toTrashRender)},fromTrashItems:function(t){var i=[];t.each((function(){i.push(e(this).data("id"))})),i.length&&e(r.page).val(1),this.request("from_trash_orders",{ids:i},this.toTrashRender)},deleteOrders:function(t){var i=[];t.each((function(){i.push(e(this).data("id"))})),i.length&&e(r.page).val(1),this.request("delete_orders",{ids:i},this.toTrashRender)},placeOrders:function(t){var i=[];t.each((function(){i.push(e(this).data("id"))})),n.bulk(i)},bulk:function(){var t=this;e("body").on("click","#bulk-apply",(function(i){i.preventDefault();var r=e("#bulk-action").val(),a=e("#ali-orders-list").find('.table-container [id^="check-item-"]:checked').closest(".order-item");if(!a.length)return window.ADS.notify(e(".select-element-text").val()),!1;switch(r){case"totrash":t.toTrashItems(a);break;case"from_trash":t.fromTrashItems(a);break;case"delete":t.deleteOrders(a);break;case"place_orders":t.placeOrders(a)}return!1}))},handler:function(){var i=this,a=e(document);i.bulk(),a.on("click","#btn-clear",(function(){e("#all-fulfillment").val("all").change(),e("#all-status").val("all").change(),e.each({ads_page:1,status:"all",s:"",from:"",to:"",fulfillment:"all"},(function(t,i){e("#params").find('input[name="'+t+'"]').val(i)})),e.event.trigger({type:"datepicker:change"}),i.listOrders(),e.event.trigger({type:"changedocinfo"})})),a.on("click",".js-to_trash",(function(){i.toTrash(e(this))})),a.on("click",".js-restore",(function(){var a=e(this).closest(".order-item").find('[name="id"]').val();e(t.orders).find('[name="id"]').length<=1&&e(r.page).val(1),i.request("from_trash_orders",{ids:[a]},i.toTrashRender)})),a.on("change",'[name="fulfillment"]',(function(){e(this).closest(".fulfillment").removeClass("status- status-blue status-green status-orange status-dark status-light-red"),i.changeFulfillment(e(this))})),a.on("pagination:click",(function(t){e(r.page).val(t.page),i.listOrders(),e.event.trigger({type:"changedocinfo"})})),a.on("datepicker:update",(function(){e(r.page).val(1),i.listOrders(),e.event.trigger({type:"changedocinfo"})})),a.on("click","#btn-search",(function(t){t.preventDefault();var r=e("#search").val().trim();e("#ads_page").val(1),e("#s").val(r),i.listOrders(),e.event.trigger({type:"changedocinfo"})})),a.on("change","#all-status",(function(t){e("#status").val(e(this).val()),e("#ads_page").val(1),i.listOrders(),e.event.trigger({type:"changedocinfo"})})),a.on("change","#all-fulfillment",(function(t){e("#fulfillment").val(e(this).val()),e(r.page).val(1),i.listOrders(),e.event.trigger({type:"changedocinfo"})})),a.on("click",".js-type",(function(){e(".js-type").removeClass("active"),e(this).addClass("active");var t="all_orders"===e(this).data("action")?0:1;e("#trash").val(t),e(r.page).val(1),e("#s").val(""),e("#all-status").val("all").selectpicker("refresh"),e("#status").val("all"),i.listOrders(),e.event.trigger({type:"changedocinfo"})})),a.on("click",".order-show-more",(function(t){t.preventDefault();var r=e(this).closest(".order-item");e(this).hasClass("opened")?e(".order-more-"+r.data("id")).toggle():(e(this).addClass("opened"),i.request("show_more",r,i.showMoreRender))})),window.ADS.switchery(e("#action-box"))},renderOrderDetails:function(t){t&&(t.hasOwnProperty("error")?window.ADS.notify(t.error,"danger"):(e(a.details).html(window.ADS.objTotmpl(e(a.tmpl_details).html(),t)),e(a.shipping).html(window.ADS.objTotmpl(e(a.tmpl_shipping).html(),t)),e(a.action).html(window.ADS.objTotmpl(e(a.tmpl_action).html(),t)),e(a.items).html(window.ADS.objTotmpl(e(a.tmpl_items).html(),t)),setTimeout(window.ADS.switchery(e("#wpbody-content")),300),t.billing_address?e(a.billing).html(window.ADS.objTotmpl(e(a.tmpl_billing).html(),t)):e(".js-billing_address").hide(),e("body").hasClass("expansion-alids-init")&&(e(".autofilling").show(),e("a#get_tracking").show())))},orderDetails:function(){var t=e("#order_id").val();t&&this.request("order_details","id="+t,this.renderOrderDetails)},handlerItems:function(){var t=this,i=this,r=e(document);r.on("click",".js-move_to",(function(){Orders.request("to_trash_order","id="+e("#order_id").val(),(function(e){e&&(e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):window.ADS.notify(e.message,"success"))}))})),r.on("change",'[name="fulfillment"]',(function(){i.request("change_fulfillment","fulfillment="+e(this).val()+"&id="+e("#order_id").val(),(function(e){e&&(e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):window.ADS.notify(e.message,"success"))}))})),r.on("change",'[name="status"]',(function(){i.request("change_status","status="+e(this).val()+"&id="+e("#order_id").val(),(function(e){e&&(e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):(window.ADS.notify(e.message,"success"),Orders.orderDetails()))}))}));var a=null;r.on("change keydown keypress keyup","#adminDescription",(function(){clearTimeout(a),a=setTimeout((function(){var i=e("#adminDescription").val(),r=e("#adminDescription").attr("data-tid");t.request("save_adminDescription",{id:r,val:i},(function(e){e&&(e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):window.ADS.notify(e.message,"success"))}))}),300)}))},order:function(){e(document).on("click",".js-edit_shipping",(function(){e("#shipping-info, #shipping-form").toggle()}))},init:function(){$this=this,e(t.orders).length?(this.handler(),this.checker(),this.listOrders()):(this.handlerItems(),this.orderDetails())},getOrder:function(){return new Promise((function(t,i){var r=e("#order_id").val();r&&Orders.request("order_details","id="+r,t)}))}},Orders.init(),e("body").on("click",".js-edit_shipping",(function(){Orders.getOrder().then((function(t){var i=e("#tmpl-edit-shipping_details").html(),r=e("#tmpl-edit-shipping_details_head").html();window.adsModal.show(r,window.ADS.objTotmpl(i,t)),setTimeout(window.ADS.switchery(e("#wpbody-content")),300),t.cpf&&t.cpf_name?e("#cpf").prev().html(t.cpf_name):e("#cpf").parent().replaceWith(""),t.cpf2&&t.cpf2_name?e("#cpf2").prev().html(t.cpf2_name):e("#cpf2").parent().replaceWith("")}))})),e("body").on("click","#js-edit_shipping_save",(function(t){t.preventDefault();var i=e(this).closest("#ads-modal");Orders.request("edit_order",i,(function(e){e&&(e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):(window.ADS.notify(e.message,"success"),Orders.orderDetails())),window.adsModal.hide()}))}));var n=function(){var t,i={active:!1,ids:[]};function r(){if(i.ids){var t,r=i.ids.shift();if(!r)return i.active=!1,void window.postMessage({source:"NAME_SOURCE_PAGE_ADD_ORDER",action:"pageOrders:openTabListOrders",info:{}},"*");t=r,e.ajax({url:ajaxurl,data:{action:"ads_placeOrderOnAli",trans_id:t},type:"POST",dataType:"json",success:function(e){data=e,data&&window.postMessage({source:"NAME_SOURCE_PAGE_ADD_ORDER",action:"addOrderBulk",info:data},"*")}})}else alert("bulk done")}function a(t){e.ajax({url:ajaxurl,data:{action:"ads_placeOrderOnAli",trans_id:t},type:"POST",dataType:"json",success:function(e){data=e,data&&window.postMessage({source:"NAME_SOURCE_PAGE_ADD_ORDER",action:"addOrder",info:data},"*")}})}return{init:function(){if(t)return t;t=this;var i={score:{url:window.location.href,name:"nameScore",type:"addOrder"}};return window.ADS.Dispatcher.on("doneAutofillBulk",(function(e){r()}),this,!1),setTimeout((function(){window.postMessage({source:"NAME_SOURCE_PAGE_ADD_ORDER",action:"initPageOrders",info:i},"*")}),1e3),window.addEventListener("message",(function(e){e.source===window&&(e.data.source||"NAME_SOURCE_PAGE_ADD_ORDER_STORE"===e.data.source)&&window.ADS.Dispatcher.trigger(e.data.action,e.data.info)})),e("body").on("click","a.autofilling",(function(){var t=parseInt(e(this).data("tid"));t&&a(t)})),t},bulk:function(e){i.active=!0,i.ids=e,r()}}}().init();({init:function(){window.ADS.Dispatcher.on("adsGoogleExtension:setOrderTIP",(function(t){if(void 0!==t.orderIdStore&&void 0!==t.orderDetail.trackingNo){var i=t.orderDetail.trackingNo.trim(),r=e('[data-item_id="'+t.orderIdStore+'"]'),a=e("#msg-tip-success").text();a=a.replace("{trackingNo}",i),r.length&&(r.data("tip",i),r.find(".tip").hide(0).html('<a href="http://www.17track.net/?nums='+i+'" target="_blank">'+i+"</a>").show(300),window.ADS.notify(a,"success"))}else{var n=e("#msg-tip-error").text();window.ADS.notify(n)}}),this),window.ADS.Dispatcher.on("adsGoogleExtension:setOrdersTIP",(function(t){if(void 0!==t.ordersDetail&&t.ordersDetail.length){var i=e("#msg-tip-success-all").text();window.ADS.notify(i,"success"),Orders.orderDetails()}else{var r=e("#msg-tip-error").text();window.ADS.notify(r)}}),this),window.ADS.Dispatcher.on("adsGoogleExtension:setOrdersIdAli",(function(e){Orders.orderDetails()}),this),e("body").on("click","a.js-get-tracking",(function(t){t.preventDefault();var i=e(this).closest(".more-order-line"),r=i.data("item_id"),a=i.data("order_number");a&&r&&window.ADS.aliExtension.getTIPOrder(r,a)})),e("body").on("click","a#get_tracking",(function(){window.ADS.aliExtension.isAuthExtensionInStore().then((function(e){Orders.getOrder().then((function(e){var t=e.list.map((function(e){return e.tip?null:e.order_number}));(t=t.filter(Boolean)).length&&window.ADS.aliExtension.getTIPOrders(t)}))}))})),e("body").on("click",".js-placeorder-manually",(function(){var t=e(this).attr("href"),i=e(this).closest(".more-order-line"),r=i.data("item_id"),a=i.data("order_number"),n=i.data("product_id"),s=i.data("product_url");if(window.AvailableExtensions.is()&&!a&&r&&n)return window.ADS.aliExtension.placeOrderManually(t,n,r,s),!1})),e("body").on("click",".js-edit-tip",(function(t){t.preventDefault();var i=e(this).closest(".more-order-line"),r=i.data("tip"),a=i.data("order_number"),n=i.data("item_id"),s=e("#tmpl-edit-tip-head").text(),o={tip:r,order_number:a,item_id:n},d=e("#tmpl-edit-tip").html();window.adsModal.show(s,window.ADS.objTotmpl(d,o))})),e("body").on("click","#js-saveTIP",(function(t){t.preventDefault();var i=e(this).closest("#ads-modal"),r=i.find("#item_id"),a=i.find("#tip"),n=i.find("#order_number"),s=e.trim(r.val()),o=e.trim(a.val()),d=e.trim(n.val());e.ajax({url:ajaxurl,data:{action:"ads_save_tip",id:s,tip:o,order:d},type:"POST",success:function(e){"done"==e&&Orders.orderDetails()}}),window.adsModal.hide()}))}}).init(),function(){var t,i=".js-list-sku-row",r=".js-select-sku-item",a={head:"#tmpl-select-variation-head",sku:"#tmpl-select-variation",footer:"#tmpl-select-variation-footer"},n={skuAttr:{},sku:{},detailsCurrent:[],skuRender:[]};function s(){var t=[];e(r+".active").each((function(i,r){t.push(e(this).data("key"))}));var i=t.length;e(r).addClass("disabled"),e.each(n.skuAttr,(function(a){var n=a.split(";"),s=0;for(var o in t)t[o]==n[o]&&s++;s>=i-1&&e.each(n,(function(t){e(r+'[data-key="'+n[t]+'"]').removeClass("disabled")}))})),e(r+".active.disabled").removeClass("active")}function o(t){var i=e(a.sku).html(),o=e(a.head).text(),d=e(a.footer).text(),l=window.ADS.objTotmpl(i,t);window.adsModal.show(o,l,d,"md"),n.skuAttr=t.skuAttr,n.sku=t.sku,n.detailsCurrent=t.detailsCurrent,n.skuRender=t.skuRender,function(){for(var t in n.detailsCurrent){var i=n.detailsCurrent[t],a=i.prop_id+":"+i.sku_id;e(r+'[data-key="'+a+'"]',"body").addClass("active")}}(),s()}return{request:window.ADS.request("OrderSku"),init:function(){t||(t=this,e("body").on("click",r+":not(.disabled)",(function(){e(this).closest(i).find(r).removeClass("active"),e(this).addClass("active"),s()})),e("body").on("click","#btn-csv",(function(t){t.preventDefault();var i=e("#date-from").val(),r=e("#date-to").val(),a=e("#status").val(),n=e("#fulfillment").val(),s=e("#search").val(),o=e(this).attr("href");i=(i=i?Date.parse(i):"")?"&date-from="+moment(i).format("YYYY-MM-DD"):"",r=(r=r?Date.parse(r):"")?"&date-to="+moment(r).format("YYYY-MM-DD"):"",window.location.replace(o+"&status="+a+"&fulfillment="+n+"&s="+s+r+i)})),e("body").on("click","#js-variation_save",(function(){var a,s=(a=[],e(r+".active").each((function(t,i){a.push(e(this).data("key"))})),e(i).length!==a.length?[]:a);t.request("save",{post_id:n.post_id,trans_id:n.trans_id,item_id:n.item_id,value:s},(function(e){e&&(e.hasOwnProperty("error")?window.ADS.notify(e.error,"danger"):(window.ADS.notify(e.message,"success"),Orders.orderDetails())),n={skuAttr:{},sku:{},detailsCurrent:[],skuRender:[]},window.adsModal.hide()}))})),e("body").on("click",".js-edit-details",(function(){var i=e(this).closest(".table-item");n.item_id=i.data("item_id"),n.trans_id=i.data("trans_id"),n.post_id=i.data("post_id"),t.request("params",{post_id:n.post_id,trans_id:n.trans_id,item_id:n.item_id},(function(e){e.error?window.ADS.notify(e.error,"danger"):o(e)}))})))}}}().init()}));