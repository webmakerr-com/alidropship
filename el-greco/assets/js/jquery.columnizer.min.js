!function(t){var e="columnizer-original-dom";t.fn.columnize=function(s){this.each((function(){var i=t(this);i.data(e,i.clone(!0,!0))})),this.cols=[],this.offset=0,this.before=[],this.lastOther=0,this.prevMax=0,this.debug=0,this.setColumnStart=null,this.elipsisText="";var n={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,precise:!1,manualBreaks:!1,disableSingle:!1,cssClassPrefix:"",elipsisText:"...",debug:0};s=t.extend(n,s);var l=new Array;function o(e){for(i=0;i<l.length;i++)e.is("table")&&(0==e.children("tfoot").length&&e.hasClass(l[i].tableID)&&t(l[i].tfoot).clone().prependTo(e),0==e.children("thead").length&&e.hasClass(l[i].tableID)&&t(l[i].thead).clone().prependTo(e)),e.find("table ."+l[i].tableID).each((function(){0==t(this).children("tfoot").length&&t(l[i].tfoot).clone().prependTo(this),0==t(this).children("thead").length&&t(l[i].thead).clone().prependTo(this)}))}function a(t,e){try{t.append(e)}catch(i){t[0].appendChild(e[0])}}return t("table").each((function(){t(this).hasClass("tableSaved")||(t(this).addClass("tableSaved"),t(this).addClass("tableID-"+l.length),l.push({tableID:"tableID-"+l.length,thead:t(this).find("thead:first").clone(),tfoot:t(this).find("tfoot:first").clone()}))})),"string"==typeof s.width&&(s.width=parseInt(s.width,10),isNaN(s.width)&&(s.width=n.width)),"function"==typeof s.setColumnStart&&(this.setColumnStart=s.setColumnStart),"string"==typeof s.elipsisText&&(this.elipsisText=s.elipsisText),s.debug&&(this.debug=s.debug),s.setWidth||(s.precise?s.setWidth=function(t){return 100/t}:s.setWidth=function(t){return Math.floor(100/t)}),this.each((function(){var e=s.target?t(s.target):t(this),i=t(this).height(),l=t("<div></div>"),r=0,h=s.manualBreaks,d=n.cssClassPrefix;"string"==typeof s.cssClassPrefix&&(d=s.cssClassPrefix);if(a(l,t(this).contents().clone(!0)),!s.ignoreImageLoading&&!s.target&&!e.data("imageLoaded")&&(e.data("imageLoaded",!0),t(this).find("img").length>0)){var f=function(t,e){return function(){t.data("firstImageLoaded")||(t.data("firstImageLoaded","true"),a(t.empty(),e.children().clone(!0)),t.columnize(s))}}(t(this),l);return t(this).find("img").one("load",f),void t(this).find("img").one("abort",f)}function c(t,e){var i=e?".":"";return d.length?i+d+"-"+t:i+t}function u(e,i,n,l){for(;(h||n.height()<l)&&i[0].childNodes.length;){var o=i[0].childNodes[0];if(t(o).find(c("columnbreak",!0)).length)return;if(t(o).hasClass(c("columnbreak")))return;a(e,t(o))}if(0!==e[0].childNodes.length){var r=e[0].childNodes,d=r[r.length-1];e[0].removeChild(d);var f=t(d);if(3==f[0].nodeType){var u,g=f[0].nodeValue,m=s.width/18;s.accuracy&&(m=s.accuracy);for(var v=null;n.height()<l&&g.length;){var p=g.indexOf(" ",m);u=-1!=p?g.substring(0,p):g,v=document.createTextNode(u),a(e,t(v)),g=g.length>m&&-1!=p?g.substring(p):""}if(n.height()>=l&&null!==v&&(e[0].removeChild(v),g=v.nodeValue+g),!g.length)return!1;f[0].nodeValue=g}return i.contents().length?i.prepend(f):a(i,f),3==f[0].nodeType}}function g(t,e,i,s){if(t.contents(":last").find(c("columnbreak",!0)).length)o(e);else if(t.contents(":last").hasClass(c("columnbreak")))o(e);else{if(e.contents().length){var n=e.contents(":first");if(void 0===n.get(0)||1!=n.get(0).nodeType)return;var l=n.clone(!0);if(n.hasClass(c("columnbreak")))a(t,l),n.remove();else if(h)a(t,l),n.remove();else if(1==l.get(0).nodeType&&!l.hasClass(c("dontend")))if(a(t,l),l.is("img")&&i.height()<s+20)n.remove();else if(n.hasClass(c("dontsplit"))&&i.height()<s+20)n.remove();else if(l.is("img")||n.hasClass(c("dontsplit")))l.remove();else{if(l.empty(),u(l,n,i,s))n.addClass(c("split"));else{if(n.addClass(c("split")),"OL"==n.get(0).tagName){var r=l.get(0).childElementCount+l.get(0).start;n.attr("start",r+1)}n.children().length&&g(l,n,i,s)}if(0===l.get(0).childNodes.length)l.remove(),n.removeClass(c("split"));else if(1==l.get(0).childNodes.length){var d=l.get(0).childNodes[0];if(3==d.nodeType){var f=d.nodeValue;/\S/.test(f)||(l.remove(),n.removeClass(c("split")))}}}}o(e)}}function m(){if(!e.data("columnized")||1!=e.children().length){if(e.data("columnized",!0),e.data("columnizing",!0),e.empty(),e.append(t("<div class='"+c("first")+" "+c("last")+" "+c("column")+" ' style='width:100%; float: "+s.columnFloat+";'></div>")),$col=e.children().eq(e.children().length-1),$destroyable=l.clone(!0),s.overflow){for(targetHeight=s.overflow.height,u($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(c("dontend"))||g($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&v($col.contents(":last").get(0));){var i=$col.contents(":last");i.remove(),$destroyable.prepend(i)}for(var n="",o=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var r=$destroyable[0].childNodes[0];if(r.attributes)for(var h=0;h<r.attributes.length;h++)0===r.attributes[h].nodeName.indexOf("jQuery")&&r.removeAttribute(r.attributes[h].nodeName);o.innerHTML="",o.appendChild($destroyable[0].childNodes[0]),n+=o.innerHTML}t(s.overflow.id)[0].innerHTML=n}else a($col,$destroyable.contents());e.data("columnizing",!1),s.overflow&&s.overflow.doneFunc&&s.overflow.doneFunc(),s.doneFunc()}}function v(e){return 3==e.nodeType?!!/^\s+$/.test(e.nodeValue)&&(!!e.previousSibling&&v(e.previousSibling)):1==e.nodeType&&(!!t(e).hasClass(c("dontend"))||0!==e.childNodes.length&&v(e.childNodes[e.childNodes.length-1]))}function p(){if(0,r!=e.width()){r=e.width();var n=Math.round(e.width()/s.width),o=s.width,d=s.height;if(s.columns&&(n=s.columns),h&&(n=l.find(c("columnbreak",!0)).length+1,o=!1),n<=1&&!s.disableSingle)return m();if(!e.data("columnizing")){e.data("columnized",!0),e.data("columnizing",!0),e.empty(),e.append(t("<div style='width:"+s.setWidth(n)+"%; float: "+s.columnFloat+";'></div>")),a(x=e.children(":last"),l.clone()),i=x.height(),e.empty();var f=i/n,p=3,b=!1;s.overflow?(p=1,f=s.overflow.height):d&&o&&(p=1,f=d,b=!0);for(var y=0;y<p&&y<20;y++){var w,C,x,T;e.empty();try{w=l.clone(!0)}catch(t){w=l.clone()}w.css("visibility","hidden");for(var N=0;N<n;N++)C=0===N?c("first"):"",C+=" "+c("column"),C=N==n-1?c("last")+" "+C:C,e.append(t("<div class='"+C+"' style='width:"+s.setWidth(n)+"%; float: "+s.columnFloat+";'></div>"));for(N=0;N<n-(s.overflow?0:1)||b&&w.contents().text().length;){for(e.children().length<=N&&e.append(t("<div class='"+C+"' style='width:"+s.setWidth(n)+"%; float: "+s.columnFloat+";'></div>")),x=e.children().eq(N),b&&x.width(o+"px"),u(x,w,x,f),g(x,w,x,f);x.contents(":last").length&&v(x.contents(":last").get(0));)(T=x.contents(":last")).remove(),w.prepend(T);N++,0===x.contents().length&&w.contents().length?x.append(w.contents(":first")):N!=n-(s.overflow?0:1)||s.overflow||w.find(c("columnbreak",!0)).length&&n++}if(s.overflow&&!b){if(document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.")){for(var L="",$=document.createElement("DIV");w[0].childNodes.length>0;){var M=w[0].childNodes[0];for(N=0;N<M.attributes.length;N++)0===M.attributes[N].nodeName.indexOf("jQuery")&&M.removeAttribute(M.attributes[N].nodeName);$.innerHTML="",$.appendChild(w[0].childNodes[0]),L+=$.innerHTML}t(s.overflow.id)[0].innerHTML=L}else t(s.overflow.id).empty().append(w.contents().clone(!0))}else if(b)e.children().each((function(t){(x=e.children().eq(t)).width(o+"px"),0===t?x.addClass(c("first")):t==e.children().length-1?x.addClass(c("last")):(x.removeClass(c("first")),x.removeClass(c("last")))})),e.width(e.children().length*o+"px");else{x=e.children().eq(e.children().length-1),w.contents().each((function(){x.append(t(this))}));x.height();var O=0,S=1e7,I=0,z=!1,k=0;e.children().each(function(t){return function(e){var i=t.children().eq(e);if(!i.children(":last").find(c("columnbreak",!0)).length){var s=i.height();z=!1,O+=s,s>I&&(I=s,z=!0),s<S&&(S=s),k++}}}(e));var F=O/k;0===O?y=p:s.lastNeverTallest&&z?(5,f+=30,y==p-1&&p++):I-S>30?f=F+30:Math.abs(F-f)>20?f=F:y=p}e.append(t("<br style='clear:both;'>"))}e.find(c("column",!0)).find(":first"+c("removeiffirst",!0)).remove(),e.find(c("column",!0)).find(":last"+c("removeiflast",!0)).remove(),e.find(c("split",!0)).find(":first"+c("removeiffirst",!0)).remove(),e.find(c("split",!0)).find(":last"+c("removeiflast",!0)).remove(),e.data("columnizing",!1),s.overflow&&s.overflow.doneFunc(),s.doneFunc()}}}e.empty(),p(),s.buildOnce||t(window).resize((function(){s.buildOnce||(e.data("timeout")&&clearTimeout(e.data("timeout")),e.data("timeout",setTimeout(p,200)))}))}))},t.fn.uncolumnize=function(){this.each((function(){var i,s=t(this);(i=s.data(e))&&s.replaceWith(i)}))},t.fn.renumberByJS=function(e,i,s,n){if(this.setList=function(e,i,s){var n,l=this.before.parents();if((n=t(e[this.offset-1]).find(">*")).last()[0].tagName!=s.toUpperCase())return this.debug&&console.log("Last item in previous column, isn't a list..."),0;n=n.length;var o,a=1;if(a=this.lastOther<=0?this.before.children().length+1:t(l[this.lastOther]).children().length+1,t(e[this.offset]).find(s+":first li.split").length){var r=t(e[this.offset-1]).find(s+":last li:last");if(""===this.elipsisText||t(e[this.offset-1]).find(s+":last ~ div").length||t(e[this.offset-1]).find(s+":last ~ p").length);else if(0==t(r).find("ul, ol, dl").length){var h=r.last().text(),d=h.length;";"==h.substring(d-1)?h.substring(d-4)!=this.elipsisText+";"&&(h=h.substring(0,d-1)+this.elipsisText+";"):h.substring(d-3)!=this.elipsisText&&(h+=this.elipsisText),r.last().text(h)}0==t(e[this.offset]).find(s+":first >li.split >"+s).length&&a--}(1==n&&(a+=this.prevMax),this.nest>1)?(this.debug&&console.log("Supposed to be a nested list...decr"),a--,(o=t(e[this.offset-1]).find(s+":first li.split:first")).length>0&&(this.debug&&console.log("Previous column started with a split item, so that count is one less than expected"),a--),(o=t(e[this.offset]).find(s+":first li:first").clone()).children().remove(),t.trim(o.text()).length>0&&(this.debug&&console.log("If that was a complete list in the previous column, don't decr."),a++,0==t(e[this.offset-1]).find(">"+s+":last ").children().length&&(this.debug&&console.log("unless that was empty, in which case revert"),a--))):(o=t(e[this.offset]).find(s+":first li:first "+s+".split li.split")).length>0&&(this.debug&&console.log("[Nested] Column started with a split item, so that count is one less than expected"),a--);return this.debug&&console.log("Setting the start value to "+a+" ("+this.prevMax+")"),a>0&&("function"==typeof this.setColumnStart?this.setColumnStart(i,a):i.attr("start",a)),0},void 0===s&&(s=!1),void 0===n&&(n=!1),!s&&!n)throw"renumberByJS(): Bad param, must pass an id or a class";var l="";this.prevMax=1,l=n?"."+n:"#"+s;var o=e.toLowerCase(),a=e.toUpperCase();for(this.cols=t(l),this.debug&&console.log("There are "+this.cols.length+" items, looking for "+o),this.before=t(this.cols[0]).find(o+":last"),this.prevMax=this.before.children().length,this.offset=1;this.offset<this.cols.length;this.offset++)if(this.debug&&console.log("iterating "+this.offset+"...[of "+this.cols.length+"]"),this.offset%i!=0){if(this.before=t(this.cols[this.offset-1]).find(o+":last"),this.before.length){this.debug&&console.log("Have some "+e+" elements in the previous column");var r=t(this.cols[this.offset]).find(o+":first");if(t(this.cols[this.offset]).find("*:first")[0]!==r[0])continue;var h=this.before.parents();this.lastOther=0;for(;this.lastOther<h.length;this.lastOther++)if(h[this.lastOther].tagName!=a&&"LI"!=h[this.lastOther].tagName){!0,this.lastOther--;break}this.nest=1,t(this.cols[this.offset]).find(">"+o+":first li "+o+":first").length&&(this.nest=2),this.setList(this.cols,r,o),this.lastOther--,(r=t(this.cols[this.offset]).find(o+":first li "+o+":first")).length&&(this.before=t(this.cols[this.offset-1]).find(">"+o+":last li "+o+":last"),this.prevMax=0,this.nest=1,this.setList(this.cols,r,o));var d=t(this.cols[this.offset-1]).find(">"+o+":last");this.prevMax=d.children().length}}else this.debug&&console.log("First column (in theory..)"),this.prevMax=1;return 0}}(jQuery);
